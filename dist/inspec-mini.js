var Inspec={};Inspec.util={};Inspec.reporters={};Inspec.matchers={};Inspec.reporters={};Inspec.dsl={};Inspec.options={};Inspec.root=this;Inspec.load=function(){var a=[];while(arguments.length){var b=Array.prototype.shift.call(arguments);if(typeof b=="array"){a=a.concat(b)}else if(typeof b=="string"){a.push(b)}}var c=Inspec.Environment.getInstance();for(var i=0;i<a.length;i++){c.load(a[i])}return this};Inspec.run=function(){var a=Inspec.Environment.getInstance();a.run()}Inspec.merge=function(a,b){var c=this.clone(a);for(var i in b)c[i]=b[i];return c}Inspec.clone=function(a){var b={};for(var i in a)b[i]=a[i];return b}Inspec.Class=function(){};Inspec.Class._initializing=false;Inspec.Class._fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;Inspec.Class.extend=function(e){var f=this.prototype;Inspec.Class._initializing=true;var g=new this();Inspec.Class._initializing=false;for(var h in e){g[h]=typeof e[h]=='function'&&typeof f[h]=='function'&&Inspec.Class._fnTest.test(e[h])?(function(c,d){return function(){var a=this._super;this._super=f[c];var b=d.apply(this,arguments);this._super=a;return b}})(h,e[h]):e[h]}function Class(){if(!Inspec.Class._initializing&&this.init)this.init.apply(this,arguments)}Class.prototype=g;Class.constructor=Class;Class.extend=arguments.callee;return Class};Inspec.util.TreeNode=function(a,b){if(!a)throw"Node name HAS to be provided";this._parent=null;this._name=a;this._content=b;this._children=[];this._childrenHash={}};Inspec.util.TreeNode.max=function(a){return Math.max.apply(Math,a)};Inspec.util.TreeNode.min=function(a){return Math.min.apply(Math,a)};Inspec.util.TreeNode.prototype={add:function(a){if(typeof this._childrenHash[a.getName()]!="undefined")throw"Child already added";this._children.push(a);this._childrenHash[a.getName()]=this._children.length-1;a.setParent(this);return a},remove:function(a){if(a){var b=this._childrenHash[a.getName()];this._children.splice(b,1);delete this._childrenHash[a.getName()];a.setAsRoot()}return a},removeFromParent:function(){if(this.isRoot())return;this.getParent().remove(this)},removeAll:function(){this.eachChildren(function(a){a.setAsRoot()},this);this._children=[];this._childrenHash={}},get:function(a){var b=this._childrenHash[a];return this.getAt(b)},getAt:function(a){if(a)return this._children[a];return null},getContent:function(){return this._content},getName:function(){return this._name},getParent:function(){return this._parent},getAllParents:function(){if(this.isRoot())return null;var a=[];var b=this.getParent();while(b){a.push(b);b=b.getParent()}return a},getFirstChild:function(){return this._children[0]},getLastChild:function(){return this._children[this._children.length-1]},getRoot:function(){var a=this while(!a.isRoot()){a=a.getParent()}return a},getFirstSibling:function(){if(this.isRoot())return this;return this.getParent()._children[0]},getLastSibling:function(){if(this.isRoot())return this;return this.getParent()._children[this._children.length-1]},getNextSibling:function(){var a=this.position();if(a==-1||a==this.getParent().size()-1)return null;return this.getParent()._children[a+1]},position:function(){if(this.isRoot())return-1;var a=this.getParent()._children;for(var i=0;i<a.length;i++){if(a[i]==this)return i}return-1},getPreviousSibling:function(){var a=this.position();if(a<=0)return null;return this.getParent()._children[a-1]},setContent:function(a){this._content=a},hasContent:function(){rv=(this.getContent()!=null&&typeof this.getContent()!="undefined");return rv},hasChildren:function(){return(this._children.length>0)},isRoot:function(){return(this._parent==null)},isLeaf:function(){return(!this.hasChildren())},isFirstSibling:function(){return(this.getFirstSibling()===this)},isLastSibling:function(){return(this.getLastSibling()===this)},isOnlyChild:function(){return(this.getParent()._children.length==1)},eachChild:function(a,b){if(typeof a=="function"){for(var i=0;i<this._children.length;i++){a.call(b,this._children[i])}}},eachSibling:function(b,c){if(this.isRoot())return null;this.getParent().eachChild(function(a){if(a!=this)b.call(c,a)},this)},each:function(a,b){this.preorderedEach(a,b)},preorderedEach:function(b,c){b.call(c,this);this.eachChild(function(a){a.preorderedEach(b,c)},this)},breadthEach:function(b,c){var d=[this];while(d.length>0){var e=d.shift b.call(c,e);e.eachChild(function(a){d.push(a)},this)}},eachLeaf:function(b,c){this.each(function(a){if(a.isLeaf())b.call(c,a)},this)},size:function(){return this._children.length},length:function(){return this.size()},depth:function(){var b=1;if(!this.isLeaf()){var c=[];this.eachChildren(function(a){c.push(a.depth())},this);deapth+=Inspec.util.TreeNode.max(c)}return depath},breadth:function(){if(this.isRoot())return 1;return this.getParent().size()},setParent:function(a){this._parent=a},setAsRoot:function(){this.setParent(null)}}Inspec.util.Messenger=function(){this.events={}};Inspec.util.Messenger.prototype={send:function(a,b){var c=this.events[a];if(!c)return;for(var i=0;i<c.length;i++)c[i].fn.call(c[i].scope,b)},on:function(a,b,c){this.events[a]=this.events[a]||[];var d={};d.fn=b;d.scope=c||this;this.events[a].push(d)},un:function(a,b,c){var d=this.events[a];if(!d)return;c=c||this;for(var i=0;i<d.length;i++)if(d[i].fn===b&&d[i].scope===c)d.splice(i--,1)}};Inspec.dsl.BDD={describe:function(a,b){Inspec.ExampleGroup.createExampleGroup(a,b)},shareExamplesFor:function(a,b){Inspec.ExampleGroup.createExampleGroup(a,b,{shared:true})},itShouldBehaveLike:function(a){Inspec.ExampleGroup.createExampleGroup(a,null)},expect:function(a){return new Inspec.Expectation(a)},it:function(a,b){Inspec.Example.createExample(a,b)},beforeEach:function(a){Inspec.ExampleGroup.setBeforeEach(a)},afterEach:function(a){Inspec.ExampleGroup.setAfterEach(a)},beforeAll:function(a){Inspec.ExampleGroup.setBeforeAll(a)},afterAll:function(a){Inspec.ExampleGroup.setAfterAll(a)}};Inspec.dsl.BDD.context=Inspec.dsl.BDD.describe;Inspec.dsl.BDD.sharedExamplesFor=Inspec.dsl.BDD.shareExamplesFor;Inspec.Example=Inspec.Class.extend({init:function(a,b,c,d){this.exampleGroup=a;this.description=b;this.implementation=c;this.options=d},getDescription:function(){return this.description}});Inspec.Example.createExample=function(a,b){var c=Inspec.ExampleGroup.current();if(!c){throw new Error("Cannot Create examples outside of ExampleGroup!");}var d=new Inspec.Example(c,a,b);c.addExample(d)};Inspec.ExampleGroupManager=Inspec.Class.extend({init:function(){this.shared={}this.root=new Inspec.util.TreeNode('root');this.current=this.root},add:function(a){if(a.isShared()){this.shared[a.getDescription()]=a}else{var b=new Inspec.util.TreeNode(a.getDescription(),a);this.current.add(b);a.setNode(b);this.initExampleGroup(a)}},solidifySharedExampleGroup:function(a){if(a.isConcrete())return;var b=this.shared[a.getDescription()];a.implementation=b.implementation;this.initExampleGroup(a)},initExampleGroup:function(a){if(!a.isConcrete())return;this.current=a.node;a.implementation.call(a.defaultScope);this.current=a.node.getParent()},prepare:function(){this.root.each(function(a){if(a.hasContent()&&(!a.getContent().isConcrete()))this.solidifySharedExampleGroup(a.getContent())},this)},currentExampleGroup:function(){return this.current.getContent()}});Inspec.ExampleGroup=Inspec.Class.extend({init:function(a,b,c){this.description=a;this.implementation=b;this.examples=[];this.shared=false;if(c)this.shared=true;this.node=null;this.defaultScope={}},getDescription:function(){return this.description},getImplementation:function(){return this.implementation},getNode:function(){return this.node},setNode:function(a){this.node=a;this.initDefaultScope(this)},initDefaultScope:function(a){var b=a.getParent();if(b)this.initDefaultScope(b);this.defaultScope=Inspec.merge(this.defaultScope,a.defaultScope)},getParent:function(){var a=this.getNode().getParent();if(a){return a.getContent()}return null},getChildren:function(){var b={children:[]};this.getNode().eachChild(function(a){this.children.push(a.getContent())},b);return b.children},getBeforeEach:function(){return this.beforeEach},getAfterEach:function(){return this.afterEach},getBeforeAll:function(){return this.beforeAll},getAfterAll:function(){return this.afterAll},setBeforeEach:function(a){this.beforeEach=a},setAfterEach:function(a){this.afterEach=a},setBeforeAll:function(a){this.beforeAll=a},setAfterAll:function(a){this.afterAll=a},isShared:function(){return this.shared},isConcrete:function(){return(this.implementation&&typeof this.implementation=='function')},hasExamples:function(){return(this.isConcrete()&&this.examples.length>0)},addExample:function(a){this.examples.push(a)}});Inspec.ExampleGroup.current=function(){return Inspec.Environment.getInstance().getExampleGroupManager().currentExampleGroup()};Inspec.ExampleGroup.setBeforeEach=function(a){this.current().setBeforeEach(a)};Inspec.ExampleGroup.setAfterEach=function(a){this.current().setAfterEach(a)};Inspec.ExampleGroup.setBeforeAll=function(a){this.current().setBeforeAll(a)};Inspec.ExampleGroup.setAfterAll=function(a){this.current().setAfterAll(a)};Inspec.ExampleGroup.createExampleGroup=function(a,b,c){var d=new Inspec.ExampleGroup(a,b,c);Inspec.Environment.getInstance().getExampleGroupManager().add(d)};Inspec.Runner=Inspec.Class.extend({init:function(a,b){this.root=a;this.messenger=b},execute:function(){this.messenger.send("beginTest");this.root.each(function(a){var b=a.getContent();if(b)this.executeExampleGroup(b)},this);this.messenger.send("endTest")},executeExampleGroup:function(a){if(a.hasExamples()){var b=null;this.messenger.send("beginExampleGroup",{exampleGroup:a});var c=a.defaultScope;try{this.executeBeforeAll(a,c)}catch(e){b=b||e}this.executeExamples(a,c);try{this.executeAfterAll(a,c)}catch(e){b=b||e}this.messenger.send("endExampleGroup",{exampleGroup:a,error:b})}},executeExamples:function(a,b){for(var i=0;i<a.examples.length;i++){this.executeExample(a.examples[i],Inspec.clone(b))}},executeBeforeAll:function(a,b){var c=a.getParent();if(c){this.executeBeforeAll(c)}if(typeof a.beforeAll=="function")a.beforeAll.call(b)},executeAfterAll:function(a,b){if(typeof a.afterAll=="function")a.afterAll.call(b);var c=a.getParent();if(c){this.executeAfterAll(c)}},executeBeforeEach:function(a,b){var c=a.getParent();if(c){this.executeBeforeEach(c)}if(typeof a.beforeEach=="function")a.beforeEach.call(b)},executeAfterEach:function(a,b){if(typeof a.afterEach=="function")a.afterEach.call(b);var c=a.getParent();if(c){this.executeAfterEach(c)}},executeExample:function(a,b){var c=null;var d=a.exampleGroup;this.messenger.send("beginExample",{example:a});try{this.executeBeforeEach(d,b);this.executeExampleImplementation(a,b)}catch(e){c=c||e}try{this.executeAfterEach(d,b)}catch(e){c=c||e}var f=c?false:true;this.messenger.send("endExample",{example:a,success:f,error:c})},executeExampleImplementation:function(a,b){if(!a.implementation){throw new Inspec.ExamplePending();}a.implementation.call(b)}});Inspec.Reporter=Inspec.Class.extend({init:function(a){this.messenger=a;this.subscribeMessages()},log:function(a){Inspec.Environment.getInstance().log(a)},subscribeMessages:function(){this.messenger.on("beginTest",this.onStartTest,this);this.messenger.on("endTest",this.onEndTest,this);this.messenger.on("beginExampleGroup",this.onStartExampleGroup,this);this.messenger.on("endExampleGroup",this.onEndExampleGroup,this);this.messenger.on("beginExample",this.onStartExample,this);this.messenger.on("endExample",this.onEndExample,this)},onStartTest:function(a){throw new Inspec.NotImplemented();},onEndTest:function(a){throw new Inspec.NotImplemented();},onStartExampleGroup:function(a){throw new Inspec.NotImplemented();},onEndExampleGroup:function(a){throw new Inspec.NotImplemented();},onStartExample:function(a){throw new Inspec.NotImplemented();},onEndExample:function(a){throw new Inspec.NotImplemented();}});Inspec.ConsoleReporter=Inspec.Reporter.extend({onStartTest:function(a){this.log("Start Test")},onEndTest:function(a){this.log("End Test")},onStartExampleGroup:function(a){},onEndExampleGroup:function(a){},onStartExample:function(a){this.log(this.getDescription(a.example))},onEndExample:function(a){var b=a.example;var c=a.success;var d=a.error;if(c)this.log("success");else{if(d instanceof Inspec.ExpectationFailure){this.log("Failure : "+d)}else if(d instanceof Error){this.log("Error : "+d)}}},getExampleGroupDescription:function(a){var b=a.getParent();var c=a.getDescription();if(b)c=this.getExampleGroupDescription(b)+" "+c;return c},getDescription:function(a){var b=this.getExampleGroupDescription(a.exampleGroup)+" "+a.getDescription();return b}});Inspec.HtmlReporter=Inspec.Reporter.extend({onStartTest:function(a){this.document=Inspec.root.document;var b=this.document.getElementsByTagName('body')[0];var c=this.document.createElement('div');c.id="inspec";b.appendChild(c);this.viewport=c},onEndTest:function(a){},onStartExampleGroup:function(a){},onEndExampleGroup:function(a){},onStartExample:function(a){},onEndExample:function(a){var b=a.example;var c=a.success;var d=a.error;var e=this.getDescription(a.example);var f=this.document.createElement('div');var g=this.document.createElement('div');g.className="title";var h=this.document.createElement('div');h.className="description";h.innerHTML=e;var i=this.document.createElement('br');i.setAttribute("clear","both");var j=this.document.createElement('div');j.className="status";if(c){f.className="example success";g.appendChild(j);g.appendChild(h);g.appendChild(i);f.appendChild(g)}else{if(d instanceof Inspec.ExpectationFailure){f.className="example failure";g.appendChild(j);g.appendChild(h);g.appendChild(i);f.appendChild(g);var k=this.document.createElement('div');k.className="explanation";k.innerHTML=d.toString();f.appendChild(k)}else if(d instanceof Inspec.ExamplePending){f.className="example pending";g.appendChild(j);g.appendChild(h);g.appendChild(i);f.appendChild(g)}else if(d instanceof Error){f.className="example error";g.appendChild(j);g.appendChild(h);g.appendChild(i);f.appendChild(g);var k=this.document.createElement('div');k.className="explanation";k.innerHTML=d.toString();f.appendChild(k)}}this.viewport.appendChild(f)},getExampleGroupDescription:function(a){var b=a.getParent();var c=a.getDescription();if(b)c=this.getExampleGroupDescription(b)+" "+c;return c},getDescription:function(a){var b=this.getExampleGroupDescription(a.exampleGroup)+" "+a.getDescription();return b}});Inspec.Exception=Inspec.Class.extend({init:function(a){if(a)this.message=a.toString()},toString:function(){return this.message}});Inspec.ExpectationFailure=Inspec.Exception.extend({});Inspec.ExamplePending=Inspec.Exception.extend({});Inspec.NotImplemented=Inspec.Exception.extend({});Inspec.UnkownEnvironment=Inspec.Exception.extend({});Inspec.Expectation=Inspec.Class.extend({init:function(a){this.subject=a;this.negative=false},judge:function(a){var b=a.matches();if(!b){throw new Inspec.ExpectationFailure(a);}},not:function(){this.negative=!this.negative;return this},toEqual:function(a){var b=new Inspec.matchers.IdentityMatcher(a,this.subject,{negative:this.negative});this.judge(b)},toBeA:function(a){var b=new Inspec.matchers.InstanceMatcher(a,this.subject,{negative:this.negative});this.judge(b)},toBeAtLeast:function(a){var b=new Inspec.matchers.ComparisonMatcher(a,this.subject,{negative:this.negative,operator:">="});this.judge(b)},toBeAtMost:function(a){var b=new Inspec.matchers.ComparisonMatcher(a,this.subject,{negative:this.negative,operator:"<="});this.judge(b)},toBeNull:function(){this.toEqual(null)},toBeUndefined:function(){this.toBe(anUndefinedValue)},toBeEmpty:function(){},toBeTrue:function(){this.toEqual(true)},toBeFalse:function(){this.toEqual(false)},toBeType:function(a){var b=new Inspec.matchers.TypeMatcher(a,this.subject,{negative:this.negative});this.judge(b)},toBeGreaterThan:function(a){var b=new Inspec.matchers.ComparisonMatcher(a,this.subject,{negative:this.negative,operator:">"});this.judge(b)},toBeLessThan:function(a){var b=new Inspec.matchers.ComparisonMatcher(a,this.subject,{negative:this.negative,operator:"<"});this.judge(b)},toBeWithIn:function(a,b){var c=new Inspec.util.Range(a,b);var d=new Inspec.matchers.RangeMatcher(c,this.subject,{negative:this.negative});this.judge(d)},toHaveLength:function(a){var b=new Inspec.matchers.IdentityMatcher(a,this.subject.length,{negative:this.negative});this.judge(b)},toInclude:function(a){},toMatch:function(a){},toRespondTo:function(a){},toEql:function(a){var b=new Inspec.matchers.EqualityMatcher(a,this.subject,{negative:this.negative});this.judge(b)},toBe:function(a){},toThrowError:function(){},toHave:function(a,b){},toHaveExactly:function(a,b){},toHaveAtLeast:function(a,b){},toHaveAtMost:function(a,b){}});Inspec.Expectation.prototype.toBeAn=Inspec.Expectation.prototype.toBeA;Inspec.Expectation.prototype.toBe=Inspec.Expectation.prototype.toEql;Inspec.matchers.Matcher=Inspec.Class.extend({init:function(a,b,c){this.expected=a;this.actual=b;this.negative=c.negative;this.result=null},matches:function(){throw new Inspec.NotImplemented();},explain:function(){throw new Inspec.NotImplemented();},xor:function(l,r){return(l||r)&&!(l&&r)},toString:function(){return this.explain()}});Inspec.matchers.ComparisonMatcher=Inspec.matchers.Matcher.extend({init:function(a,b,c){this._super.apply(this,arguments);this.operator=c.operator},matches:function(){this.result=eval("this.actual"+this.operator+"this.expected");this.result=this.xor(this.result,this.negative);return this.result},explain:function(){if(this.result==null)this.matches();var a="Expected "+this.actual.toString();a+=(this.negative?" not":"");a+=" to be "+this.operator+" to "+this.expected;if(!this.result)return a}});Inspec.matchers.EqualityMatcher=Inspec.matchers.Matcher.extend({matches:function(){this.result=(this.expected==this.actual);this.result=this.xor(this.result,this.negative);return this.result},explain:function(){if(this.result==null)this.matches();var a="Expected "+this.actual.toString();a+=(this.negative?" not":"");a+=" to be identical (===) to "+this.expected;if(!this.result)return a}});Inspec.matchers.IdentityMatcher=Inspec.matchers.Matcher.extend({matches:function(){this.result=(this.expected===this.actual);this.result=this.xor(this.result,this.negative);return this.result},explain:function(){if(this.result==null)this.matches();var a="Expected "+this.actual.toString();a+=(this.negative?" not":"");a+=" to be identical (===) to "+this.expected;if(!this.result)return a}});Inspec.matchers.InstanceMatcher=Inspec.matchers.Matcher.extend({matches:function(){this.result=(this.actual instanceof this.expected);this.result=this.xor(this.result,this.negative);return this.result},explain:function(){if(this.result==null)this.matches();var a="Expected "+this.actual;a+=(this.negative?" not":"");a+=" to be an instance of '"+this.expected+"'";if(!this.result)return a}});Inspec.matchers.RegexMatcher=Inspec.matchers.Matcher.extend({matches:function(){this.result=(this.actual.toString().match(this.expected));this.result=this.xor(this.result,this.negative);return this.result},explain:function(){if(this.result==null)this.matches();var a="Expected "+this.actual.toString();a+=(this.negative?" not":"");a+=" to be identical (===) to "+this.expected;if(!this.result)return a}});Inspec.matchers.TypeMatcher=Inspec.matchers.Matcher.extend({matches:function(){this.result=(typeof this.actual===this.expected);this.result=this.xor(this.result,this.negative);return this.result},explain:function(){if(this.result==null)this.matches();var a="Expected "+this.actual;a+=(this.negative?" not":"");a+=" to be type '"+this.expected+"'";a+=", but was type '"+typeof this.actual+"'";if(!this.result)return a}});Inspec.Environment=Inspec.Class.extend({init:function(){this.initFacility()},initFacility:function(){this.messenger=new Inspec.util.Messenger();this.exampleGroupManager=new Inspec.ExampleGroupManager();var a=this.reporterClass();this.reporter=new a(this.messenger);this.runner=new Inspec.Runner(this.exampleGroupManager.root,this.messenger)},getExampleGroupManager:function(){return this.exampleGroupManager},getMessenger:function(){return this.messenger},getReporter:function(){return this.reporter},getRunner:function(){return this.runner},run:function(){this.exampleGroupManager.prepare();this.runner.execute()},load:function(a){var b=this.preprocess(this.loadFile(a));var c=new Function("dsl",b);c.call(Inspec.root,Inspec.options.dsl)},preprocess:function(a){return"with (dsl) { "+a+" }"},reporterClass:function(){throw new Inspec.NotImplemented();},loadFile:function(a){throw new Inspec.NotImplemented();},log:function(a){throw new Inspec.NotImplemented();}});Inspec.Environment.getInstance=function(){if(!Inspec.Environment._instance){if(Inspec.root.navigator)Inspec.Environment._instance=new Inspec.BrowserEnvironment();else if(Inspec.root.load)Inspec.Environment._instance=new Inspec.RhinoEnvironment();else if(Inspec.root.WScript)Inspec.Environment._instance=new Inspec.WScriptEnvironment();else throw new Inspec.UnkownEnvironment();}return Inspec.Environment._instance};Inspec.BrowserEnvironment=Inspec.Environment.extend({reporterClass:function(){return Inspec.HtmlReporter},loadFile:function(a){if(window.XMLHttpRequest)var b=new XMLHttpRequest();else var b=new ActiveXObject("Microsoft.XMLHTTP");if(b){b.open("GET",a,false);b.send(null);return b.responseText}else{return null}},log:function(a){if(console&&console.log&&typeof console.log=="function")console.log(a)}});Inspec.RhinoEnvironment=Inspec.Environment.extend({reporterClass:function(){return Inspec.ConsoleReporter},loadFile:function(a){return readFile(a)},log:function(a){print(msg)}});Inspec.WScriptEnvironment=Inspec.Environment.extend({reporterClass:function(){return Inspec.ConsoleReporter},loadFile:function(a){var b=new Inspec.root.ActiveXObject('Scripting.FileSystemObject');var c;try{c=b.OpenTextFile(a);return c.ReadAll()}finally{try{if(c)c.Close()}catch(ignored){}}},log:function(a){Inspec.root.WScript.Echo(a)}});Inspec.options.dsl=Inspec.dsl.BDD;